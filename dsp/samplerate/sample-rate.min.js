let debug=!1;const graphStyle={line:{color:"#0882ff",color2:"#ffa631",width:3},xAxis:{color:"#aaa"},yAxis:{grid:{color:"black",opacity:.133}},mark:{line:{color:"#f20a0a",width:3},fillOpacity:.85,radius:5}};let Module={preRun:[],postRun:[],print:function(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments).join(" ")),console.log(e)},printErr:function(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments).join(" ")),console.error(e)},setStatus:function(e){Module.setStatus.last||(Module.setStatus.last={time:Date.now(),text:""}),e!==Module.setStatus.last.text&&console.log(e)},totalDependencies:0,monitorRunDependencies:function(e){this.totalDependencies=Math.max(this.totalDependencies,e),Module.setStatus(e?"Preparing... ("+(this.totalDependencies-e)+"/"+this.totalDependencies+")":"All downloads complete.")}};function*genSine(e,t=0){const n=Math.sin(t),o=Math.cos(t);let a=0,l=1;yield n;let r=Math.sin(e);const i=Math.cos(e);let s=i;yield r*o+s*n;const c=2*i;for(;;){const e=c*r-a,t=c*s-l;yield e*o+t*n,a=r,r=e,l=s,s=t}}function getGenSine(e,t=0){const n=genSine(e,t);return function(){return n.next().value}}function sCurve(e){return(e=2*e-1)/Math.pow(1+16*e*e*e*e,.25)+.5}function getDrawOnNextAnimationFrameThrottled(e){let t=!1;return()=>{t||(requestAnimationFrame(()=>{e(),t=!1}),t=!0)}}function getThrottledCallback(e,t,n=0){let o=!1,a=!1;return function l(){if(a)o=!0;else{a=!0;const r=(()=>o||0==n?(e(),t):(o=!0,n))();setTimeout(()=>{a=!1,o&&(l(),o=!1)},r)}}}function fillCanvas(e,t="black"){e.save(),e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.restore()}function lerp(e,t,n){return e*(1-n)+t*n}(()=>{const e=document.getElementById("sampling").getContext("2d"),t=document.getElementById("samplingParameter");function n(){const n=Number.parseFloat(t.value)/100;e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.setTransform(1,0,0,-1,.5,Math.trunc(e.canvas.height/2)+.5),e.strokeStyle=graphStyle.xAxis.color,e.beginPath(),e.moveTo(0,0),e.lineTo(e.canvas.width-1,0),e.stroke();const o=e.canvas.height/2,a=getGenSine(.01,5*-n),l=.9*o*(1-sCurve(1.25*n)),r=getGenSine(.02,-3.5-7*n),i=sCurve(2*(n-.45)),s=o*(sCurve(2*(n-.25))-.5*i),c=getGenSine(.06,-3.1-22*n),d=.5*o*i;function u(){return a()*l+r()*s+c()*d}let h=[];e.strokeStyle=graphStyle.line.color,e.lineWidth=graphStyle.line.width,e.lineCap="round",e.beginPath(),e.moveTo(0,u());let g=12;for(let t=1;t!=e.canvas.width/2+1;++t){const n=2*t,o=u();e.lineTo(n,o),25==++g&&(h.push([n,o]),g=0)}e.stroke();const m=graphStyle.mark.radius;e.strokeStyle=graphStyle.yAxis.grid.color,e.lineWidth=1,e.globalAlpha=graphStyle.yAxis.grid.opacity,e.beginPath();for(let t of h)if(Math.abs(t[1])>m){const n=Math.sign(t[1]);e.moveTo(t[0],n),e.lineTo(t[0],t[1]-n*m)}e.stroke(),e.globalAlpha=1,e.strokeStyle=graphStyle.mark.line.color,e.lineWidth=graphStyle.mark.line.width,e.fillStyle=graphStyle.line.color2;for(let t of h)e.beginPath(),e.ellipse(t[0],t[1],m,m,0,0,2*Math.PI),e.globalAlpha=graphStyle.mark.fillOpacity,e.fill(),e.globalAlpha=1,e.stroke();e.restore()}n(),t.addEventListener("input",getDrawOnNextAnimationFrameThrottled(n))})(),(()=>{const e=document.getElementById("fourierSeries").getContext("2d",{alpha:!1}),t=document.getElementById("fourierSeriesComponentsCount"),n=document.getElementById("fourierSeriesCountDisplay");function o(){const o=1;fillCanvas(e,"white"),e.save(),e.setTransform(1,0,0,-1,.5,Math.trunc(7*e.canvas.height/8)+.5),e.strokeStyle=graphStyle.xAxis.color,e.lineWidth=1,e.beginPath(),e.moveTo(0,0),e.lineTo(e.canvas.width-1,0),e.stroke(),e.strokeStyle=graphStyle.line.color;const a=e.canvas.width/2,l=6*e.canvas.height/8;e.beginPath(),e.moveTo(0,0),e.lineTo(a,0),e.lineTo(a,l),e.lineTo(e.canvas.width-1,l),e.lineWidth=3*graphStyle.line.width,e.globalAlpha=.3,e.stroke(),e.lineWidth=1,e.globalAlpha=1,e.stroke(),e.strokeStyle="#333",e.lineWidth=1,e.lineCap="round",e.lineJoin="round";const r=new Array(Math.round(e.canvas.width)+1).fill(.5),i=-2/Math.PI;function s(t,n){const a=i/t,s=Math.PI*t,c=getGenSine(s*o/e.canvas.width,.5*s);e.beginPath();{const t=c()*a;r[0]+=t,e.moveTo(0,(.5+t)*l)}n+=1;for(let t=1;t!=r.length-1;++t){const o=c()*a;r[t]+=o,(n<2||t%n==0)&&e.lineTo(t,(.5+o)*l)}{const t=c()*a;r[r.length-1]+=t,e.lineTo(r.length-1,(.5+t)*l)}e.stroke()}const c=Number.parseInt(t.value);for(let t=1;t!=c;++t)e.globalAlpha=.9/(c-t+1)+.1,s(2*t-1,Math.round(t/100));e.strokeStyle=graphStyle.line.color2,s(2*c-1,0),e.globalAlpha=1,e.lineWidth=graphStyle.line.width,function(){e.beginPath(),e.moveTo(0,r[0]*l);for(let t=1;t!=r.length;++t)e.lineTo(t,r[t]*l);e.stroke()}(),e.restore(),n.textContent=c.toString()}o(),t.addEventListener("input",getDrawOnNextAnimationFrameThrottled(o))})();const lanczosKernel=(()=>{const e=new Array(146),t=5/(e.length-1);e[0]=1,e[e.length-1]=0;for(let n=1;n!=e.length-1;++n){const o=n*t*Math.PI;e[n]=5*Math.sin(o)*Math.sin(o/5)/(o*o)}const n=(e.length-1)/5;return t=>{if((t=Math.abs(t))>=5)return 0;const o=t*n,a=Math.floor(o),l=o-a;return lerp(e[a],e[a+1],l)}})();function rand(e){function t(e){return 1013904222&1664525*e}return t(t(e))/2147483647*4-1}function noise(e){const t=Math.floor(e),n=e-t;if(debug)return lerp(rand(t),rand(t+1),n);let o=0;for(let e=-5;6!=e;++e)o+=lanczosKernel(e-n)*rand(t+e);return o}function blackmanWindow(e){const t=2*Math.PI*e;return.42-.5*Math.cos(t)+.08*Math.cos(2*t)}(()=>{const e=Math.floor(22),t=44-e,n=document.getElementById("waveShape"),o=document.getElementById("reconstruction").getContext("2d",{alpha:!1}),a=document.getElementById("waveFrequency"),l=document.getElementById("randomizeNoiseButton"),r=.75*o.canvas.height/2,i=Math.round(o.canvas.width/20),s=2,c=new Map;function d(e,t){let n=0;const a=t/o.canvas.width,l=a/s;return{func:t=>e(a*t),drawing:()=>{const t=e(n);return n+=l,t}}}c.set("sine",e=>{const t=2*Math.PI*e/o.canvas.width;return{func:e=>Math.sin(t*e),drawing:getGenSine(t/s)}});const u=e=>0==e?-1:e%1,h=e=>0==e?-1:Math.sign(e);c.set("square",e=>d(e=>h(.5*h(e)-u(e)),e)),c.set("triangle",e=>d(e=>1-4*Math.abs(u(e+.25)-.5*h(e+.25)),e)),c.set("saw",e=>d(e=>2*u(e)-h(e),e)),c.set("saw2",e=>d(e=>h(e)-2*u(e),e));let g=5;c.set("noise",e=>d(e=>noise(2*e+g),e));let m=e=>{e.setTransform(1,0,0,1,0,0),e.fillStyle="gray",e.textBaseline="top",e.textAlign="right",e.font="16px sans-serif",e.fillText("loading module...",e.canvas.width-5,5)};function p(){fillCanvas(o,"white"),o.save(),o.setTransform(1,0,0,-1,.5,Math.trunc(o.canvas.height/2)+.5),o.strokeStyle=graphStyle.xAxis.color,o.beginPath(),o.moveTo(0,0),o.lineTo(o.canvas.width-1,0),o.stroke();try{const l=c.get(n.value)(Number.parseFloat(a.value)),s=[],d=[],u=.66;for(let t=-e;0!=t;++t){const n=t*i;d.push(n);let o=l.func(n);const a=1+t/e;a<u&&(o*=blackmanWindow(.5*a/u)),s.push(o)}o.strokeStyle=graphStyle.line.color,o.lineCap="round",o.lineJoin="round",o.beginPath();const h=l.drawing();d.push(0),s.push(h),o.moveTo(0,h*r),o.lineTo(.5,l.drawing()*r);for(let e=1;e!=o.canvas.width;++e){const t=l.drawing();e%i==0&&(d.push(e),s.push(t)),o.lineTo(e,t*r),o.lineTo(e+.5,l.drawing()*r)}o.lineWidth=3*graphStyle.line.width,o.globalAlpha=.2,o.stroke(),o.lineWidth=1,o.globalAlpha=1,o.stroke();const g=graphStyle.mark.radius;o.strokeStyle=graphStyle.yAxis.grid.color,o.globalAlpha=graphStyle.yAxis.grid.opacity,o.lineWidth=1,o.beginPath();for(let t=e+1;t!=s.length&&!(d[t]>=o.canvas.width);++t){const e=s[t]*r;if(Math.abs(e)>g){const n=Math.sign(e);o.moveTo(d[t],n),o.lineTo(d[t],e-n*g)}}o.stroke(),o.globalAlpha=1,o.strokeStyle=graphStyle.mark.line.color,o.lineWidth=graphStyle.mark.line.width,o.fillStyle=graphStyle.line.color2;for(let t=e+1;t!=s.length&&!(d[t]>=o.canvas.width);++t)o.beginPath(),o.ellipse(d[t],s[t]*r,g,g,0,0,2*Math.PI),o.globalAlpha=graphStyle.mark.fillOpacity,o.fill(),o.globalAlpha=1,o.stroke();const p=d[d.length-1];for(let e=0;e!=t;++e){const n=p+(e+1)*i;d.push(n);let o=l.func(n);const a=1-e/t;a<u&&(o*=blackmanWindow(.5*a/u)),s.push(o)}m(o,s)}catch(e){console.error(`Error occurred while drawing shape '${n.selectedOptions[0].textContent}' (${n.value}): ${e}`)}o.restore()}p(),Module.postRun.push(()=>{const t=new Module.KissFftReal(64),n=new Module.KissFftRealInverse(1024);m=((o,a)=>{t.getInputTimeDataBuffer().set(a);const l=t.transform(),i=n.getInputFrequencyDataBuffer();for(let e=0;64!=e;++e)i[e]=l[e];i[64]=.5*l[64],i[65]=.5*l[65];const s=n.transform(),c=r/64;o.strokeStyle=graphStyle.line.color2,o.lineWidth=graphStyle.line.width,o.beginPath();const d=debug?1024/o.canvas.width:64*o.canvas.width/20480,u=debug?0:1024*e/64;let h=u;for(o.moveTo(0,s[h]*c),++h;h!=s.length;++h){const e=(h-u)*d;if(o.lineTo(e,s[h]*c),e>o.canvas.width)break}o.stroke()}),p()}),a.addEventListener("input",getDrawOnNextAnimationFrameThrottled(p)),n.addEventListener("change",()=>{p(),"noise"==n.value?l.classList.remove("hidden"):l.classList.add("hidden")}),l.addEventListener("click",()=>{g=4294967295*Math.random()&4294967295,p()})})();const getDefaultSampleRate=(()=>{try{const e=new AudioContext,t=e.sampleRate;return e.close(),function(){return t}}catch(e){return function(){return null}}})();function setDefaulSampleRateOption(e){const t=getDefaultSampleRate();let n=null;null!==t&&(n=e.querySelector(`option[value="${t}"]`)),null!==n?n.textContent+=" (default)":(n=document.createElement("OPTION"),null!==t?(n.value=t.toString(),n.textContent=`default (${t} Hz)`):(n.value="",n.textContent="default"),e.insertBefore(n,e.childNodes[0])),n.selected=!0}function clamp(e,t,n){return e<t?t:e>n?n:e}function setupColorSchemeChooser(e,t,n){const o=document.querySelector(e+" input.color"),a=document.querySelector(e+" input.white"),l=document.querySelector(e+" input.black");function r(e){if(255==e)return[255,255,255];return[clamp(4*(e-64),0,255),Math.max(4*(e-192),0),clamp(383-4*Math.abs(e-96),0,255)]}function i(e){return[e,e,e]}function s(e){const t=255-e;return[t,t,t]}const c=(()=>{const e=t.createLinearGradient(0,0,0,t.canvas.height);return e.addColorStop(0,"rgb(63, 63, 63)"),e.addColorStop(.25,"rgb(0, 0, 255)"),e.addColorStop(.5,"rgb(255, 0, 255)"),e.addColorStop(.75,"rgb(255, 0, 0)"),e.addColorStop(.99,"rgb(255, 255, 0)"),e.addColorStop(1,"rgb(255, 255, 255)"),e})(),d=(()=>{const e=t.createLinearGradient(0,0,0,t.canvas.height);return e.addColorStop(0,"rgb(63, 63, 63)"),e.addColorStop(.25,"rgb(63, 63, 63)"),e.addColorStop(1,"rgb(255, 255, 255)"),e})(),u=(()=>{const e=t.createLinearGradient(0,0,0,t.canvas.height);return e.addColorStop(0,"rgb(193, 193, 193)"),e.addColorStop(.25,"rgb(193, 193, 193)"),e.addColorStop(1,"rgb(0, 0, 0)"),e})();function h(){return a.checked?{intensity:i,gradient:d,baseColor:"black"}:l.checked?{intensity:s,gradient:u,baseColor:"white"}:{intensity:r,gradient:c,baseColor:"black"}}const g=()=>{n(h())};return o.addEventListener("change",g),a.addEventListener("change",g),l.addEventListener("change",g),h()}function formatHz(e){return e%100==0?`${e/1e3} kHz`:`${e} Hz`}class LinearSpectrogram{constructor(e){this.slice=e.createImageData(1,e.canvas.height)}drawSlice(e,t,n,o){e.save();const a=e.canvas.height,l=this.slice.data,r=a/n.length;let i=a-1,s=0,c=0;for(let e of n)if(s+=r,c=Math.max(c,e),s>=1){const[e,t,n]=o(c);l[4*i]=e,l[4*i+1]=t,l[4*i+2]=n,l[4*i+3]=255,--i,s-=1,c=0}if(s>=1){const[e,t,n]=o(c);l[4*i]=e,l[4*i+1]=t,l[4*i+2]=n,l[4*i+3]=255}e.putImageData(this.slice,t,0),e.restore()}}class LogarithmicSpectrogram{constructor(){this.setRange(1,1e3)}setRange(e,t){if(e<=0)throw new RangeError("Range low limit must be greater than 0");if(e>=t)throw new Error("Range low limit less than high limit");this.low=e,this.high=t,this.invLog=1/Math.log(t-e+1)}drawSlice(e,t,n){e.save(),e.translate(e.canvas.width-.5,-.5);const o=e.canvas.height;let a=0,l=0;for(let r=Math.trunc(this.low);r!=t.length;++r){l=Math.max(l,t[r]);const i=Math.log(r-this.low+1)*this.invLog*o;if(i>=a+1){console.log();const[t,r,s]=n(l);e.fillStyle=`rgb(${t},${r},${s})`;const c=Math.trunc(i);e.fillRect(0,o-c,1,c-a),a=c,l=0}}e.restore()}}const harmonicsCoefficients=[0,1,0,.15,.03,.02,0,0,.01],distortionCurve=new Float32Array(1024);for(let e=0;e!=distortionCurve.length;++e){const t=e/(distortionCurve.length-1)*2-1,n=[1,t];for(let e=2;e!=harmonicsCoefficients.length;++e)n[e]=2*t*n[e-1]-n[e-2];let o=0;distortionCurve[e]=n.reduce((e,t,n)=>(o+=harmonicsCoefficients[n],e+t*harmonicsCoefficients[n]),0),distortionCurve[e]/=o}function scheduleVolumeChange(e,t,n){e.gain.cancelScheduledValues(e.context.currentTime);const o=e.gain.value,a=e.context.currentTime;e.gain.linearRampToValueAtTime(.99*o+.01*t,a+.1*n),e.gain.linearRampToValueAtTime(.95*o+.05*t,a+.2*n),e.gain.linearRampToValueAtTime(.85*o+.15*t,a+.3*n),e.gain.linearRampToValueAtTime(.15*o+.85*t,a+.7*n),e.gain.linearRampToValueAtTime(.05*o+.95*t,a+.8*n),e.gain.linearRampToValueAtTime(.01*o+.99*t,a+.9*n),e.gain.linearRampToValueAtTime(t,a+n)}(()=>{const e=document.getElementById("sampleRate");setDefaulSampleRateOption(e);const t=document.getElementById("distortion"),n=document.getElementById("spectrum").getContext("2d",{alpha:!1}),o=document.getElementById("spectrumMidFrequency"),a=document.getElementById("spectrumMaxFrequency"),l=document.getElementById("spectrogram").getContext("2d",{alpha:!1}),r=document.getElementById("spectrogramMidFrequency"),i=document.getElementById("spectrogramMaxFrequency"),s=document.getElementById("spectrogramContainer");let c;function d(){fillCanvas(n,c.baseColor),fillCanvas(l,c.baseColor)}const u=document.querySelector("#colorScheme .black");c=setupColorSchemeChooser("#colorScheme",n,e=>{c=e,d(),u.checked?s.classList.add("blackOnWhite"):s.classList.remove("blackOnWhite")}),d();const h=document.getElementById("playButton");h.addEventListener("click",function s(){const u=document.getElementById("frequencySlider");function g(){return 55*Math.pow(2,Number.parseFloat(u.value)/12)}const m=document.getElementById("volumeSlider"),p=()=>Number.parseFloat(m.value);let f=null,v=null,y=null,S=null,C=null;function b(){const n=e.value,l={};""!=n&&(l.sampleRate=Number.parseInt(n)),function(e){const t=formatHz(e);o.textContent=t,r.textContent=t}((f=new AudioContext(l)).sampleRate/4),function(e){const t=formatHz(e);a.textContent=t,i.textContent=t}(f.sampleRate/2),(v=f.createOscillator()).type="sine",v.frequency.value=g(),v.start(),(y=f.createAnalyser()).fftSize=2048,y.minDecibels=-90,y.smoothingTimeConstant=0,S=f.createWaveShaper(),t.checked&&(S.curve=distortionCurve),S.oversample="none",(C=f.createGain()).gain.value=p(),v.connect(S),S.connect(y),y.connect(C),C.connect(f.destination)}b(),t.addEventListener("change",()=>{S.curve=t.checked?distortionCurve:null});const w=document.getElementById("frequencyDisplay");u.addEventListener("input",()=>{const e=g();e<=f.sampleRate/2?(w.textContent=e.toFixed()+" Hz",v.frequency.linearRampToValueAtTime(e,f.currentTime+.05)):w.textContent="too high for sample rate"}),m.addEventListener("input",getThrottledCallback(()=>{scheduleVolumeChange(C,p(),.05)},50));const T=new LinearSpectrogram(l);function k(){const e=l.canvas.width-1;l.drawImage(l.canvas,1,0,e,l.canvas.height,0,0,e,l.canvas.height);const t=new Uint8Array(y.frequencyBinCount);y.getByteFrequencyData(t),T.drawSlice(l,l.canvas.width-1,t,c.intensity),function(e,t,n){e.save(),fillCanvas(e,c.baseColor),e.setTransform(1,0,0,-1,0,e.canvas.height);const o=e.canvas.width/t.length,a=e.canvas.height/255;e.strokeStyle=n,e.fillStyle=n,e.lineWidth=2,e.lineCap="round",e.lineJoin="round",e.beginPath(),e.moveTo(0,-1);for(let n=0;n!=t.length;++n)e.lineTo(n*o,t[n]*a);e.lineTo(e.canvas.width,-1),e.globalAlpha=.5,e.fill(),e.globalAlpha=1,e.stroke(),e.restore()}(n,t,c.gradient)}let M=setInterval(k,1e3/60);h.removeEventListener("click",s);let x=null;h.addEventListener("click",()=>{null!==x&&(clearTimeout(x),x=null),scheduleVolumeChange(C,p(),.05),"suspended"==f.state&&f.resume().then(()=>{M=setInterval(k,1e3/60)})}),document.getElementById("stopButton").addEventListener("click",()=>{null===x&&(clearInterval(M),scheduleVolumeChange(C,0,.05),x=setTimeout(()=>{f.suspend()},100))}),e.addEventListener("change",()=>{const e="running"==f.state;f.close(),d(),b(),e||f.suspend()})})})(),(()=>{const e=document.getElementById("oversamplingSampleRate"),t=()=>Number.parseInt(e.value),n=document.getElementById("oversamplingDistortion"),o=document.getElementById("noOversample"),a=document.getElementById("2xOversample"),l=document.getElementById("4xOversample");function r(){return a.checked?2:l.checked?4:1}const i=document.getElementById("oversamplingSpectrogram").getContext("2d",{alpha:!1}),s=document.getElementById("oversamplingSpectrogramMidFrequency"),c=document.getElementById("oversamplingSpectrogramMaxFrequency"),d=document.getElementById("oversampledSpectrogram").getContext("2d",{alpha:!1}),u=document.getElementById("oversampledSpectrogramMidFrequency"),h=document.getElementById("oversampledSpectrogramMaxFrequency"),g=document.getElementById("oversamplingFilterDisplay").getContext("2d",{alpha:!1}),m=document.getElementById("oversamplingFilterDisplayMidFrequency"),p=document.getElementById("oversamplingFilterDisplayMaxFrequency"),f=document.getElementById("oversamplingContainer"),v=document.getElementById("oversamplingFrequencySlider");function y(e){s.textContent=formatHz(e/4),c.textContent=formatHz(e/2)}function S(e,t){const n=e*t,o=formatHz(n/4),a=formatHz(n/2);u.textContent=o,h.textContent=a,m.textContent=o,p.textContent=a}let C;function b(){fillCanvas(i,C.baseColor),fillCanvas(d,C.baseColor)}let w=()=>{i.save(),i.fillStyle="gray",i.textBaseline="top",i.textAlign="right",i.font="16px sans-serif",i.fillText("loading module...",i.canvas.width-5,5),i.restore()};const T=()=>{fillCanvas(g,C.baseColor);const e=Number.parseFloat(v.value),t=2*Math.PI*e,n=Math.cos(t),o=Math.sin(t);function a(e){const t=o/(2*e),a=1/(1+t),l=-2*n*a,r=(1-t)*a,i=(1-n)/2*a,s=(1-n)*a,c=(1-n)/2*a,d=e=>e*e,u=16*i*c,h=-4*(i*s+4*i*c+s*c),g=d(i+s+c),m=16*r,p=-4*(l+4*r+l*r),f=d(1+l+r);return function(e){const t=d(Math.sin(Math.PI*e*.5));return 10*(Math.log10((u*t+h)*t+g)-Math.log10((m*t+p)*t+f))}}const l=a(.5411961),r=a(1.306563),i=e=>l(e)+r(e),s=e=>1/90*(e- -90);g.save(),g.setTransform(1,0,0,-1,0,g.canvas.height+10),g.strokeStyle=C.gradient,g.fillStyle=C.gradient,g.lineWidth=2,g.lineCap="round",g.lineJoin="round",g.beginPath(),g.moveTo(0,-1);const c=g.canvas.width/299;for(let e=0;300!=e;++e){const t=i(e/300);g.lineTo(e*c,Math.max(s(t)*g.canvas.height,-1))}g.lineTo(g.canvas.width,-1),g.globalAlpha=.3,g.fill(),g.globalAlpha=1,g.stroke(),g.strokeStyle="#7777",g.lineWidth=1,g.beginPath();const d=Math.round(2*e*g.canvas.width)+.5;g.moveTo(d,0),g.lineTo(d,s(-3)*g.canvas.height),g.stroke(),g.restore()},k=document.querySelector("#oversamplingColorScheme .black");C=setupColorSchemeChooser("#oversamplingColorScheme",g,e=>{C=e,b(),w(),T(),k.checked?f.classList.add("blackOnWhite"):f.classList.remove("blackOnWhite")}),b(),w(),T(),Module.postRun.push(()=>{let s=new Module.Oversampling;s.minDecibels=-90;const c=t(),u=r();y(c),S(c,u),s.sampleRate=c,s.oversample=u,s.fftSize=2048;const h=document.getElementById("oversamplingSpectrogramRenderingLabel"),g=document.getElementById("oversampledSpectrogramRenderingLabel"),m=document.getElementById("oversamplingPlayButton");let p=!0;const f=new LinearSpectrogram(i),b=new LinearSpectrogram(d);let k,M;function x(e,t){s.cutoffFrequency=e*t*Number.parseFloat(v.value)}fillCanvas(i,C.baseColor),w=(()=>{debug&&(M=performance.now(),console.log(`restarting with\nFs: ${s.sampleRate} Hz\nsweep start: ${s.startFrequency} Hz\n      end: ${Math.min(s.endFrequency,s.sampleRate/2)} (set ${s.endFrequency}) Hz\nfft size: ${s.fftSize}\noversample: ${s.oversample}\ncutoff frequency: ${s.cutoffFrequency} Hz\nharmonics coefficients: ${s.harmonicsCoefficients}`));performance.now();h.classList.remove("hidden"),g.classList.remove("hidden"),m.setAttribute("disabled",null),k=0,s.restartAndRenderStep(),f.drawSlice(i,0,s.stepFrequencyData,C.intensity),b.drawSlice(d,0,s.stepOversampledFrequencyData,C.intensity),function e(){for(let e=0;25!=e;++e){if(++k>=i.canvas.width)return p=!0,h.classList.add("hidden"),g.classList.add("hidden"),m.removeAttribute("disabled"),void(debug&&console.log(`Rendered in ${performance.now()-M} ms`));s.renderNextStep(),f.drawSlice(i,k,s.stepFrequencyData,C.intensity),b.drawSlice(d,k,s.stepOversampledFrequencyData,C.intensity)}setTimeout(e)}()}),n.checked&&(s.harmonicsCoefficients=harmonicsCoefficients);const E=document.getElementById("oversamplingVolumeSlider"),I=()=>Number.parseFloat(E.value);let B,A=null,L=null;m.addEventListener("click",()=>{if(null===A)(A=new AudioContext({sampleRate:t()})).suspend(),B=A.createBuffer(1,s.audioBufferSampleCount,A.sampleRate),E.addEventListener("input",getThrottledCallback(()=>{scheduleVolumeChange(L,I(),.05)},50));else if("suspended"!=A.state)return;p&&(B.copyToChannel(s.audioBufferData,0),p=!1),L&&L.disconnect(),(L=A.createGain()).connect(A.destination);const e=A.createBufferSource();e.buffer=B,e.connect(L),e.start(),L.gain.value=I(),A.resume().then(()=>{setTimeout(()=>{scheduleVolumeChange(L,0,.05),setTimeout(()=>{A.suspend()},100)},1950)})}),n.addEventListener("change",()=>{s.harmonicsCoefficients=n.checked?harmonicsCoefficients:[],w()}),e.addEventListener("change",()=>{const e=t(),n=r();s.sampleRate=e,x(e,n),y(e),S(e,n),w(),null!==A&&(A.close(),A=null)});const F=()=>{const e=t(),n=r();s.oversample=n,x(e,n),S(e,n),w()};o.addEventListener("change",F),a.addEventListener("change",F),l.addEventListener("change",F);const R=getThrottledCallback(()=>{w()},200,200);oversamplingFrequencySlider.addEventListener("input",getDrawOnNextAnimationFrameThrottled(()=>{x(t(),r()),T(),R()})),w()})})();